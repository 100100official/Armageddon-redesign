<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page 5</title>
    <style>
        @keyframes particleAnim {
          0%, 100% {
            opacity: 0;
            transform: translateZ(0);
          }
          50% {
            opacity: 1;
            transform: translateZ(100px);
          }
        }

        @keyframes rotZ {
          0% {
            transform: rotateX(45deg) rotateY(0) rotateZ(0);
            animation-timing-function: linear;
          }
          100% {
            transform: rotateX(45deg) rotateY(0) rotateZ(360deg);
          }
        }

        * {
          margin: 0;
          padding: 0;
        }

        body {
          background: black;
        }

        .center {
          display: block;
          position: absolute;
          left: 50%;
          top: 50%;
          perspective: 800px;
          perspective-origin: 50% 50%;
          transform: translateX(-50%) translateY(-50%);
          transform-style: preserve-3d;
        }

        .grid {
          position: relative;
          width: 160px; /* numberOfParticles * (particleSize + particleDistance) */
          height: 160px; /* numberOfParticles * (particleSize + particleDistance) */
          transform-style: preserve-3d;
          transform-origin: center;
          animation: rotZ 13s infinite linear;
        }

        .particle {
          height: 8px; /* particle size */
          width: 8px; /* particle size */
          display: block;
          position: absolute;
          opacity: 0;
          background: white;
          transform-style: preserve-3d;
        }

        .row {
          display: block;
          position: absolute;
        }

        .volume-controls {
          position: absolute;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          justify-content: space-around;
          width: 80%;
        }

        .volume-controls input[type="range"] {
          writing-mode: vertical-lr; /* Vertical */
        }
    </style>
</head>
<body>
    <div class="center">
        <div class="grid"></div>
    </div>

    <div class="volume-controls">
        <input type="range" min="0" max="1" step="0.01" value="0" id="volume1" style="writing-mode: vertical-lr;">
        <input type="range" min="0" max="1" step="0.01" value="0" id="volume2" style="writing-mode: vertical-lr;">
        <input type="range" min="0" max="1" step="0.01" value="0" id="volume3" style="writing-mode: vertical-lr;">
        <input type="range" min="0" max="1" step="0.01" value="0" id="volume4" style="writing-mode: vertical-lr;">
    </div>

    <script>
        const grid = document.querySelector('.grid');
        const numberOfParticles = 20;
        const particleSize = 8;
        const particleDistance = 0;

        for (let j = 1; j <= numberOfParticles; j++) {
            const row = document.createElement('div');
            row.classList.add('row');
            row.style.top = `${(j - 1) * (particleDistance + particleSize)}px`;

            for (let i = 1; i <= numberOfParticles; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                particle.style.left = `${(i - 1) * (particleDistance + particleSize)}px`;
                particle.style.animation = `particleAnim 3s infinite`;
                particle.style.animationDelay = `${(i + j) / 10}s`;
                row.appendChild(particle);
            }

            grid.appendChild(row);
        }

        const audioSources = [
            'supernova/Supernova_bass.mp3', 
            'supernova/Supernova_drum.mp3',
            'supernova/Supernova_vocal.mp3',
            'supernova/Supernova_other_inst.mp3'
        ];

        let audioContext;
        const audioElements = audioSources.map(src => {
            const audio = new Audio(src);
            audio.crossOrigin = "anonymous";
            audio.loop = true;
            return audio;
        });

        document.body.addEventListener('click', () => {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();

                audioElements.forEach(audio => audio.play());

                const gainNodes = [];
                const distortionNodes = [];

                function createDistortionCurve(amount) {
                    const k = typeof amount === 'number' ? amount : 50;
                    const n_samples = 44100;
                    const curve = new Float32Array(n_samples);
                    const deg = Math.PI / 180;
                    for (let i = 0; i < n_samples; ++i) {
                        const x = i * 2 / n_samples - 1;
                        curve[i] = ((3 + k) * x * 20 * deg) / (Math.PI + k * Math.abs(x));
                    }
                    return curve;
                }

                function setDistortion(audioElement, volumeControl, index) {
                    const source = audioContext.createMediaElementSource(audioElement);
                    const gainNode = audioContext.createGain();
                    const distortion = audioContext.createWaveShaper();

                    distortion.curve = createDistortionCurve(50); // 디스토션 강도 조절
                    distortion.oversample = '2x'; // 디스토션 오버샘플링 줄임

                    source.connect(gainNode);
                    gainNode.connect(distortion);
                    distortion.connect(audioContext.destination);

                    gainNode.gain.value = 0; // 초기 볼륨을 0으로 설정

                    gainNodes[index] = gainNode;

                    volumeControl.addEventListener('input', event => {
                        const volume = event.target.value;
                        gainNode.gain.value = volume * 0.5; // 전체 최대 음량을 제한
                        if (volume > 0.8) {
                            gainNode.disconnect();
                            gainNode.connect(distortion);
                        } else {
                            gainNode.disconnect();
                            gainNode.connect(audioContext.destination);
                        }
                    });
                }

                setDistortion(audioElements[0], document.getElementById('volume1'), 0);
                setDistortion(audioElements[1], document.getElementById('volume2'), 1);
                setDistortion(audioElements[2], document.getElementById('volume3'), 2);
                setDistortion(audioElements[3], document.getElementById('volume4'), 3);
            }
        }, { once: true });

        function checkVolumes() {
            const volume1 = parseFloat(document.getElementById('volume1').value);
            const volume2 = parseFloat(document.getElementById('volume2').value);
            const volume3 = parseFloat(document.getElementById('volume3').value);
            const volume4 = parseFloat(document.getElementById('volume4').value);

            if (volume1 === 1 && volume2 === 1 && volume3 === 1 && volume4 === 1) {
                setTimeout(() => {
                    const volume1After = parseFloat(document.getElementById('volume1').value);
                    const volume2After = parseFloat(document.getElementById('volume2').value);
                    const volume3After = parseFloat(document.getElementById('volume3').value);
                    const volume4After = parseFloat(document.getElementById('volume4').value);

                    if (volume1After === 1 && volume2After === 1 && volume3After === 1 && volume4After === 1) {
                        window.location.href = 'page6.html';
                    }
                }, 4000);
            }
        }

        const volumeControls = document.querySelectorAll('.volume-controls input[type="range"]');
        volumeControls.forEach(control => {
            control.addEventListener('input', checkVolumes);
        });
    </script>
</body>
</html>





<!-- python -m http.server -->
<!-- http://localhost:8000 -->